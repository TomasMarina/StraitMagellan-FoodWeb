---
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: yes
  word_document: default
# classoption: landscape
# bibliography: AMPYaganes.bib
csl: "elsevier-harvard2.csl"
documentclass: article
geometry:
- vmargin=1in
- hmargin=1in
header-includes:
- \usepackage{amsmath}
- \usepackage{pdflscape,booktabs}
- \usepackage{lscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \usepackage[running]{lineno}
- \linenumbers
- \usepackage{array}
- \usepackage{longtable}
- \usepackage{ltablex}  # Ensures wrapping in long tables

---

# Supplementary Material for 'Marine trophic network analysis and its potential resilience in the Strait of Magellan'

The following figure and tables summarise the data we used to build the network of trophic (predator-prey) interactions, food web, for the Strait of Magellan ecosystem. Details of some results are also included.

Table 1 is the complete list of trophic interactions and references that confirm each of them.

Table 2 is the species list with details on trophic species cases (aggregated taxa) and its properties (degree, closeness, betweenness, Keystone Species Index -KSI-, trophic level, and topological role).

Table 3 shows the results of the degree distribution fit of the food web.

\newpage
\blandscape

```{r tableS1, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

# Load packages
require(tidyverse)
require(knitr)
require(dplyr)
require(kableExtra)
require(pander)
require(flextable)

# Load data
int_list <- read.csv(file = "../Data/MagellanStrait_links_24jan25.csv", header = TRUE)

# Filter interaction list
int_tbl <- int_list %>% 
  distinct(Prey, Predator, .keep_all = TRUE)

# write.csv(int_tbl, file = "../InteractionList_Magellan_tocomplete.csv")

# Table S1
# Using pandoc.table()
# pandoc.table(int_tbl %>%
#                arrange(., (Predator)) %>%
#                dplyr::select(-ID) %>%
#                mutate(Reference = paste('\\tiny', Reference), Reference_link = paste('\\tiny', Reference_link)),
#              split.cells = c(10,10,5,5), split.table = Inf, justify = c("left","left","left","right"),
#              caption = "List of predator-prey (trophic) interactions used to build the food web of the Strait of Magellan.")

# Using flex.table()
# int_tbl %>%
#   arrange(Predator) %>%
#   dplyr::select(-ID) %>%
#   mutate(Reference = paste('\\tiny', Reference), Reference_link = paste('\\tiny', Reference_link)) %>%
#   flextable() %>%
#   width(j = 1:2, width = 2) %>%   # Set fixed width for first two columns
#   width(j = 3:4, width = 3) %>%   # Set flexible width for last two columns
#   autofit()

# Using knitr::kable
# Table S1 using kableExtra
int_tbl %>%
  arrange(Predator) %>%
  rename(ReferenceLink = Reference_link) %>% 
  dplyr::select(-ID) %>%
  mutate(
    Reference = paste0("\\tiny ", Reference), 
    ReferenceLink = paste0("\\tiny ", ReferenceLink)
  ) %>%
  kable("latex", booktabs = TRUE, longtable = TRUE,
        caption = "List of predator-prey (trophic) interactions used to build the food web of the Strait of Magellan.",
        escape = FALSE, align = "lccc") %>%  # Ensure alignment for each column
  kableExtra::column_spec(1, width = "4cm") %>%
  kableExtra::column_spec(2, width = "4cm") %>%
  kableExtra::column_spec(3, width = "6cm") %>%
  kableExtra::column_spec(4, width = "6cm") %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))


```

\newpage

```{r tableS2, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

# Load data
load("../Results/Network&SpProps_12feb25.rda")
load("../Results/Modularity_14jan25.rda")

# Build species list
mod_sp <- clas.role %>% 
  dplyr::select(name, type) %>% 
  rename(TrophicSpecies=name, TopRole=type)

sp_tbl <- key_ind %>% 
  left_join(mod_sp) %>% 
  rename(Degree=TotalDegree, Btw=Between, Clo=Closeness, KSI_rank=Keystone_rank, Top_role=TopRole) %>% 
  dplyr::select(TrophicSpecies, TL, Degree, Clo, Btw, KSI_rank, Top_role)

# Table S2
pandoc.table(sp_tbl %>% arrange(., (KSI_rank)) %>%
               mutate_at(vars(TL), round, 2) %>%
               mutate_at(vars(Clo, Btw), round, 4), 
             style="multiline", split.tables = Inf, justify = c("left","center","center","center","center","center","center"),
             caption = "List of species, including  node-level properties, for the food web of the Strait of Magellan. TL: Trophic Level; Clo: Closeness; Btw: Betweenness; Top_role: Topological role, where 'hubcon' = network connector, 'modcon' = module connector, 'modhub' = module hub, and 'modspe' = module specialist; KSI_rank: Keystone Species Index ranking.")

```

\elandscape

<!-- \newpage -->

<!-- ```{r tableS3, echo=FALSE, message=FALSE, warning=FALSE, results='asis'} -->

<!-- # Load data -->
<!-- load("../Datos/analisis_datos_dic24.rda") -->

<!-- # Table S3 -->
<!-- pandoc.table(dist_fit$models %>%  -->
<!--                arrange(., (AIC)) %>%  -->
<!--                dplyr::select(AIC, BIC, family, model) %>%  -->
<!--                rename("Model"="model", "Model family"="family"), style="multiline", split.tables = Inf, justify = c("left","left","left","left"), -->
<!--              caption = "Results of the degree distribution fit. Exponential and power law model families were tested, and AIC (Akaike Information Criterion) and BIC (Bayesian Information Criterion) were used to select the best fit (i.e., lower AIC and BIC). The exponential model is the best fit.") -->

<!-- ``` -->
